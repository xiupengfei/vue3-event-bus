{"version":3,"file":"vue3-event-bus.umd.js","sources":["../lib/event-bus.ts","../lib/vue3-event-bus.ts"],"sourcesContent":["/*\r\n * @Descripttion: Event Bus\r\n * @Version: v0.1\r\n * @Author: pengfei.xiu\r\n * @Date: 2022-01-23 12:49:52\r\n * @LastEditors: pengfei.xiu\r\n * @LastEditTime: 2022-01-23 15:07:19\r\n */\r\n\r\nexport interface ICallbackFun extends Function {\r\n  __once?: Function\r\n  isOnce?: boolean\r\n}\r\n\r\nclass EventBus {\r\n  constructor() {\r\n    this.eventMap = new Map()\r\n  }\r\n\r\n  eventMap: Map<string, ICallbackFun[]>\r\n\r\n  on(key: string, cb: ICallbackFun) {\r\n    let handles = this.eventMap.get(key)\r\n    if (!handles) {\r\n      handles = []\r\n    }\r\n    handles.push(cb)\r\n    this.eventMap.set(key, handles)\r\n  }\r\n\r\n  emit(key: string, payload?: any) {\r\n    const handles = this.eventMap.get(key)\r\n    if (!Array.isArray(handles)) return\r\n    handles.forEach((h) => {\r\n      h(payload)\r\n      if (h.isOnce) {\r\n        this.off(key, h)\r\n      }\r\n    })\r\n  }\r\n\r\n  once(key: string, cb: ICallbackFun) {\r\n    cb.isOnce = true\r\n    this.on(key, cb)\r\n    // let handles = this.eventMap.get(key)\r\n    // if (!handles) {\r\n    //   handles = []\r\n    // }\r\n\r\n    // cb.__once = (payload?: any) => {\r\n    //   cb(payload)\r\n    //   this.off(key, cb)\r\n    // }\r\n\r\n    // handles.push(cb.__once)\r\n    // this.eventMap.set(key, handles)\r\n  }\r\n\r\n  off(key: string, cb?: ICallbackFun) {\r\n    const handles = this.eventMap.get(key)\r\n    if (!Array.isArray(handles)) return\r\n\r\n    if (cb) {\r\n      const _handles = [...handles]\r\n      const idx = _handles.indexOf(cb)\r\n      idx > -1 && _handles.splice(idx, 1)\r\n      this.eventMap.set(key, _handles)\r\n    } else {\r\n      this.eventMap.delete(key)\r\n    }\r\n  }\r\n}\r\n\r\nexport const bus = new EventBus()\r\n\r\nexport default EventBus\r\n","/*\r\n * @Descripttion: useEventBus\r\n * @Version: v0.1\r\n * @Author: pengfei.xiu\r\n * @Date: 2022-01-23 12:11:18\r\n * @LastEditors: pengfei.xiu\r\n * @LastEditTime: 2022-01-23 15:50:55\r\n */\r\nimport { onUnmounted } from 'vue'\r\nimport { bus, ICallbackFun } from './event-bus'\r\n\r\nexport const useEventBus = () => {\r\n  const instance = {\r\n    eventMap: new Map(),\r\n    // 复用eventBus事件收集相关逻辑\r\n    on: bus.on,\r\n    once: bus.once,\r\n    // 清空eventMap\r\n    clear() {\r\n      this.eventMap.forEach((list: ICallbackFun[], key: string) => {\r\n        list.forEach((cb) => {\r\n          bus.off(key, cb)\r\n        })\r\n      })\r\n      // eventMap.clear()\r\n    },\r\n  }\r\n\r\n  // const eventMap: Map<string, ICallbackFun[]> = new Map()\r\n\r\n  const on = (key: string, cb: ICallbackFun) => {\r\n    instance.on(key, cb)\r\n    bus.on(key, cb)\r\n  }\r\n\r\n  const once = (key: string, cb: ICallbackFun) => {\r\n    instance.once(key, cb)\r\n    bus.once(key, cb)\r\n  }\r\n\r\n  onUnmounted(() => {\r\n    instance.clear()\r\n  })\r\n\r\n  return {\r\n    on,\r\n    once,\r\n    off: bus.off.bind(bus),\r\n    emit: bus.emit.bind(bus),\r\n  }\r\n}\r\n\r\nexport default useEventBus\r\n"],"names":["this","eventMap","Map","EventBus","key","cb","handles","get","push","set","payload","Array","isArray","forEach","h","isOnce","_this","off","on","_handles","idx","indexOf","splice","delete","bus","useEventBus","instance","once","clear","list","onUnmounted","bind","emit"],"mappings":";;;;;;;;;;;;;;oFAcA,iBACE,aACEA,KAAKC,SAAW,IAAIC,IAuDxB,OAlDEC,eAAA,SAAGC,EAAaC,GACd,IAAIC,EAAUN,KAAKC,SAASM,IAAIH,GAC3BE,IACHA,EAAU,IAEZA,EAAQE,KAAKH,GACbL,KAAKC,SAASQ,IAAIL,EAAKE,IAGzBH,iBAAA,SAAKC,EAAaM,GAAlB,WACQJ,EAAUN,KAAKC,SAASM,IAAIH,GAC7BO,MAAMC,QAAQN,IACnBA,EAAQO,SAAQ,SAACC,GACfA,EAAEJ,GACEI,EAAEC,QACJC,EAAKC,IAAIb,EAAKU,OAKpBX,iBAAA,SAAKC,EAAaC,GAChBA,EAAGU,QAAS,EACZf,KAAKkB,GAAGd,EAAKC,IAefF,gBAAA,SAAIC,EAAaC,GACf,IAAMC,EAAUN,KAAKC,SAASM,IAAIH,GAClC,GAAKO,MAAMC,QAAQN,GAEnB,GAAID,EAAI,CACN,IAAMc,qMAAeb,MACfc,EAAMD,EAASE,QAAQhB,GAC7Be,GAAO,GAAKD,EAASG,OAAOF,EAAK,GACjCpB,KAAKC,SAASQ,IAAIL,EAAKe,QAEvBnB,KAAKC,SAASsB,OAAOnB,SAKdoB,EAAM,IAAIrB,EC9DVsB,EAAc,WACzB,IAAMC,EAAW,CACfzB,SAAU,IAAIC,IAEdgB,GAAIM,EAAIN,GACRS,KAAMH,EAAIG,KAEVC,MAAA,WACE5B,KAAKC,SAASY,SAAQ,SAACgB,EAAsBzB,GAC3CyB,EAAKhB,SAAQ,SAACR,GACZmB,EAAIP,IAAIb,EAAKC,WAuBrB,OAJAyB,eAAY,WACVJ,EAASE,WAGJ,CACLV,GAfS,SAACd,EAAaC,GACvBqB,EAASR,GAAGd,EAAKC,GACjBmB,EAAIN,GAAGd,EAAKC,IAcZsB,KAXW,SAACvB,EAAaC,GACzBqB,EAASC,KAAKvB,EAAKC,GACnBmB,EAAIG,KAAKvB,EAAKC,IAUdY,IAAKO,EAAIP,IAAIc,KAAKP,GAClBQ,KAAMR,EAAIQ,KAAKD,KAAKP"}